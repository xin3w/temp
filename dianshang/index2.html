<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>拼一拼 99买手机了</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name='apple-touch-fullscreen' content='yes'>
		<meta name="full-screen" content="no">
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="format-detection" content="address=no" />

		<link rel="stylesheet" href="asset/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="asset/plug/swiper/swiper-3.4.0.min.css" />
		<link rel="stylesheet" href="asset/css/style.css" />

		<script src="asset/js/mr-app.js"></script>
		<script src="asset/plug/swiper/swiper-3.4.0.min.js"></script>
		<script src="asset/js/js.js"></script>

	</head>

	<body>
		<div class="float" data-name="活动未开始">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">活动还未开始，请稍后再试！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=活动未开始]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="活动已结束">
			<div class="inner">
				<div class="txt">
					<p class="f-tal">活动已结束，敬请关注中国人寿保险其他活动</p>
				</div>
				<a href="search.html" class="btn full">中奖查询</a>
			</div>
		</div>
		<div class="float" data-name="不允许建团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您的建团数量已满，暂时无建团资格！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许建团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="不允许加团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您加团的数量已满，暂时无法加入其它团！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许加团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="不允许重复加团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您已和该团内成员组过团，不能加入该团!</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许重复加团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="二维码弹层">
			<div class="inner qr-code">
				<img src="asset/img/ps1/qr-code.png" />
				<p>扫描下方二维码，加入由中国人寿保险官方微信提供的99元买手机活动</p>
			</div>
			<a href="#" class="close" onclick="closeLayer('[data-name=二维码弹层]')"></a>
		</div>
		<div class="float" data-name="分享">
			<div class="share">
				<img src="asset/img/ps1/share.png" />
				<p>呼朋唤友来参团，你懂的</p>
			</div>
			<a href="#" class="close" onclick="closeLayer('[data-name=分享]')"></a>
		</div>
		<div class="mask"></div>

		<!--banner开始-->
		<div class="banner">
			<img class="img" src="asset/img/ps1/banner-small.jpg" />
		</div>
		<div class="box border">
			<!--产品信息-->
			<div class="product">
				<a href="#" flex="main:center">
					<img src="" />
				</a>
			</div>
			<!--倒计时-->
			<div class="time-item">
				<strong id="day_show">00</strong>天<strong id="hour_show">00</strong>时<strong id="minute_show">00</strong>分<strong id="second_show">00</strong>秒
			</div>
			<p class="f-tac">您有<b>XX</b>团满<br />有<b>XX</b>个团进行中</p>
		</div>

		<div class="box mt25 mb25">
			<div class="list-joins">
				<ul>
					<li>
						<div class="list-join" flex="main:justify cross:center">
							<span onclick="pinTuan(this)"><b class="plus tx"><img src="asset/img/ps1/1.jpg"/></b></span>
							<span onclick="pinTuan(this)"><b class="plus tx"><img src="asset/img/ps1/1.jpg"/></b></span>
							<span onclick="pinTuan(this)"><b class="plus tx"><img src="asset/img/ps1/1.jpg"/></b></span>
							<u></u>
						</div>
					</li>
					<li>
						<div class="list-join" flex="main:justify cross:center">
							<span onclick="pinTuan(this)"><b class="plus tx"><img src="asset/img/ps1/1.jpg"/></b></span>
							<span onclick="pinTuan(this)"><b class="plus tx"><img src="asset/img/ps1/1.jpg"/></b></span>
							<span onclick="pinTuan(this)"><b class="plus"></b></span>
							<u></u>
						</div>
					</li>
					<li>
						<div class="list-join" flex="main:justify cross:center">
							<span onclick="pinTuan(this)"><b class="plus"><img src="asset/img/ps1/1.jpg"/></b></span>
							<span onclick="pinTuan(this)"><b class="plus"></b></span>
							<span onclick="pinTuan(this)"><b class="plus"></b></span>
							<u></u>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div class="btn-group-bot" flex="main:justify">
			<a href="#" class="btn border">查看团</a>
			<a href="#" class="btn">创建团</a>
		</div>
		<div class="count-code" data-name="统计代码">
			<script type="text/javascript">
				var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
				document.write(unescape("%3Cspan id='cnzz_stat_icon_1264381987'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1264381987%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
			</script>
		</div>
	</body>
	<script type="text/javascript">
		var count = 0;
		var status = 0; //0:活动未开始;1:活动进行中;2:活动已经结束;
		var teamID = getQueryString("teamid");

		var bannerImg,bannerImg2, curTime, startTime, endTime, productImg, productName, listJoin, isGuanzhu, jianTeam, jiaTeam;

		$(function() {
			$.infoInit();

		})

		$.infoInit = function() {
			$.ajax({
				type: "get",
				url: "product.json",
				async: false,
				success: function(res) {
					bannerImg = res.banner_img;
					bannerImg2 = res.banner_img2;
					curTime = res.curTime;
					startTime = res.start_time;
					endTime = res.end_time;
					productImg = res.product_img;
					productName = res.product_name;
					listJoin = res.list_join;
					isGuanzhu = res.is_guanzhu;
					jianTeam = res.jian_tuan;
					jiaTeam = res.jia_team;

					//设置banner
					$(".banner .img").attr("src", bannerImg2);

					//设置产品
					$(".product img").attr("src", productImg);

					//设置倒计时
					var seconds, cur;
					var timer = null;

					cur = Math.floor(new Date().getTime() / 1000);
					start = Math.floor(new Date(startTime).getTime() / 1000);
					end = Math.floor(new Date(endTime).getTime() / 1000);

					if(cur < start) {
						clearInterval(timer)
						status = 0;
						console.log("活动还未开始!");
						$(".mask[data-name=活动未开始]").show();
					}

					if(cur <= end && cur >= start) {
						status = 1;
						console.log("活动进行中!")

						seconds = end - cur;
						daojishi(seconds);

						//请求接口定时获取拼团信息msg开始
						var timerMsg = null;
						$.msg()
						timerMsg = setInterval(function() {
							$.msg();
						}, 20000);
					}

					if(cur > end) {
						clearInterval(timer)
						status = 2;
						console.log("活动已经结束!");
						$(".mask[data-name=活动已结束]").show();
					}

					console.log("status:" + status);

				}
			});
		}

		function pinTuan(obj) {
			//拼团邀请是否关注
			var status = $(obj).find('b').hasClass("tx");
			if(!status) {
				if(isGuanzhu) {
					//建团成功
					openLayer('[data-name=分享]');
				} else {
					//弹层关注
					openLayer('[data-name=二维码弹层]');
				}
			}
		}

		function showQRcode() {
			var isShow = $(".btn-group .qr-code").css("display");
			if(isShow == "none") {
				$(".btn-group .qr-code").show();
			} else {
				$(".btn-group .qr-code").hide();
			}
		}

		$.msg = function() {
			var msgItem = '';
			$.ajax({
				type: "get",
				url: "msg.json",
				async: false,
				success: function(res) {
					var myMsg = res.msg; //信息内容(img/name/type)
					for(var i = 0; i < myMsg.length; i++) {
						msgItem += '<li><span class="msg-item"><img src="' + myMsg[i].img + '"/>' + myMsg[i].name + '&nbsp;&nbsp;' + myMsg[i].type + '</span></li>';
					};
					msgItem = '<ul class="list-msg animated fadeInDown">' + msgItem + '</ul>';
					count++;
					if(count == 1) {
						$(".banner").append(msgItem);
					} else {
						$(".list-msg").removeClass('fadeInDown animated').addClass('fadeOutDown animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {
							$(".list-msg").remove();
							$(".banner").append(msgItem)
						});
					}
				}
			});
		}
	</script>

</html>