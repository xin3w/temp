<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>拼一拼 99买手机了</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name='apple-touch-fullscreen' content='yes'>
		<meta name="full-screen" content="no">
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="format-detection" content="address=no" />

		<link rel="stylesheet" href="asset/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="asset/plug/landscape/landscape.css" />
		<link rel="stylesheet" type="text/css" href="asset/plug/swiper/swiper-3.4.0.min.css" />
		<link rel="stylesheet" href="asset/css/style.css" />

		<script src="asset/js/mr-app.js"></script>
		<script src="asset/plug/swiper/swiper-3.4.0.min.js"></script>
		<script src="asset/js/js.js"></script>
	</head>

	<body>

		<div class="loader">
			<img src="asset/img/ps1/logo.png" />
		</div>

		<div class="float" data-name="活动未开始">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">活动还未开始，请稍后再试！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=活动未开始]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="活动已结束">
			<div class="inner">
				<div class="txt">
					<p class="f-tal">活动已结束，敬请关注中国人寿保险其他活动</p>
				</div>
				<a href="search.html" class="btn full">中奖查询</a>
			</div>
		</div>
		<div class="float" data-name="不允许建团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您的建团数量已满，暂时无建团资格！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许建团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="不允许加团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您加团的数量已满，暂时无法加入其它团！</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许加团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="不允许重复加团">
			<div class="inner">
				<div class="txt">
					<p class="f-tac">您已和该团内成员组过团，不能加入该团!</p>
				</div>
				<a href="#" class="btn full" onclick="closeLayer('[data-name=不允许重复加团]')">知道了</a>
			</div>
		</div>
		<div class="float" data-name="二维码弹层">
			<div class="inner qr-code">
				<img src="asset/img/ps1/qr-code.png" />
				<p>扫描下方二维码，加入由中国人寿保险官方微信提供的99元买手机活动</p>
			</div>
			<a href="#" class="close" onclick="closeLayer('[data-name=二维码弹层]')"></a>
		</div>
		<div class="float" data-name="分享">
			<div class="share">
				<img src="asset/img/ps1/share.png" />
				<p>呼朋唤友来参团，你懂的</p>
			</div>
			<a href="#" class="close" onclick="closeLayer('[data-name=分享]')"></a>
		</div>
		<div class="mask"></div>

		<div class="banner">
			<img class="img" src="asset/img/ps1/banner.jpg" />
			<div class="enter">已有<b>0</b>人参与</div>
			<!--<img class="logo" src="asset/img/ps1/u516.png" />-->
			<!--<ul class="list-msg animated fadeInDown"><li><span class="msg-item"><img src="接品图像"/>名字&nbsp;&nbsp;type</span></li><li><span class="msg-item"><img src="接品图像"/>名字&nbsp;&nbsp;type</span></li></ul>-->

		</div>
		<div class="time-item" data-name="倒计时">
			<strong id="day_show">00</strong>天<strong id="hour_show">00</strong>时<strong id="minute_show">00</strong>分<strong id="second_show">00</strong>秒
		</div>
		<div class="box">
			<div class="product" data-name="产品信息">
				<a href="details.html" flex="main:justify box:first">
					<img src="" />
					<h3></h3>
				</a>
			</div>
			<div class="list-join" data-name="团员列表">
				<span onclick="pinTuan(this)"><b class="plus"></b><s><i class="name1">团长：</i><i class="name2"></i></s></span>
				<span onclick="pinTuan(this)"><b class="plus"></b><s><i class="name2">--</i></s></span>
				<span onclick="pinTuan(this)"><b class="plus"></b><s><i class="name2">--</i></s></span>
				<u></u>
			</div>
			<div class="btn-group" data-name="创建我的团">
				<a href="#" class="btn" onclick="createTeam(this)">创建我的团</a>
				<p flex="main:center box:mean">
					<a href="#">查看我的团</a>
				</p>
			</div>
			<div class="btn-group" data-name="邀请好友入团" style="display: none;">
				<p class="team-bar" flex="main:justify"><span>团ID:<b>ASYNQ0001</b></span><span class="ico-code" onclick="showQRcode()"><b>团二维码</b></span></p>
				<p class="qr-code"><img src="asset/img/ps1/qr-code.png" /></p>
				<a href="#" class="btn" onclick="pinTuan(this)">邀请好友入团</a>
				<p flex="main:center box:mean">
					<a href="#">查看我的团</a>
					<a href="#">创建我的团</a>
				</p>
			</div>
			<div class="btn-group" data-name="创建新团" style="display: none;">
				<a href="#" class="btn" onclick="createTeam(this)">创建新团</a>
				<p flex="main:center box:mean">
					<a href="#">查看我的团</a>
				</p>
			</div>
			<div class="btn-group" data-name="加入团" style="display: none;">
				<a href="#" class="btn" onclick="joinTeam()">加入团</a>
				<p flex="main:center box:mean">
					<a href="#">查看我的团</a>
				</p>
			</div>
		</div>
		<div class="box mt25 mb25">
			<!--活动说明-->
			<div class="edit-body">
				<h3>拼团活动说明</h3>
				<ol>
					<li>本活动由“中国人寿保险”微信举办，欢迎粉丝参加。</li>
					<li>参加者每人最多可创建5个新团，每人只能加入5次他人创建的团。团内凑满三人即为满员团。相同的两人仅能出现在一个团中。创建新团和加入他人团的行为无法撤销。</li>
					<li>活动时间自2017年9月30日开始，组团成绩统计截止时间为2017年10月8日上午10点，截止后将从所有满员团中根据预先设置规则抽出5个中奖团，中奖团内每一位粉丝都可获得华为手机优惠购买券一张。</li>
					<li>以抽奖截止日当天，上证指数收盘后三位（包含小数点后两位）为抽奖基数，将所有参加组数除以发奖组数（5组），每组从小到大排列选取抽奖基数为获奖组团。<br />如：以2017年9月7日上证收盘指数后三位550、16160组团数为例，16160/5=3232，则获奖组团号码为：550，3782,7014,10246,13478.</li>
					<li>凭券可在中国人寿官方App “掌上国寿”生活频道i购商城内，以人民币99元购买华为Mate9手机一部（4G+64G全网通，颜色选择范围以购买时的可选项为准），所涉及的税费由中国人寿承担。</li>
					<li>中国人寿保险官方微信将在2017年10月10日前公布中奖名单，请参与活动的用户关注中奖信息公布，及时查询中奖信息。如超过中奖有效期未回复领取获奖权限，视为自动放弃。</li>
					<li>如发现作弊行为，中国人寿保险官方微信有权取消其获奖资格。</li>
					<li>中国人寿保险官方公众号享有活动的最终解释权。</li>
				</ol>
			</div>
		</div>
		<div class="count-code" data-name="统计代码">
			<script type="text/javascript">
				var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
				document.write(unescape("%3Cspan id='cnzz_stat_icon_1264381987'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1264381987%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
			</script>
		</div>
		<!--横竖屏-->
		<div class="landscape" style="display: none;">
			<table>
				<tbody>
					<tr>
						<td><img src="asset/plug/landscape/iphone.png" />
							<p>为了更好的体验，请使用竖屏预览！</p>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</body>

	<script type="text/javascript">
		var count = 0;
		var status = 0; //0:活动未开始;1:活动进行中;2:活动已经结束;
		var teamID = getQueryString("teamid");

		var bannerImg, bannerImg2, curTime, startTime, endTime, productImg, productName, listJoin, isGuanzhu, jianTeam, jiaTeam, visited;

		$(function() {
			$.infoInit();
		})

		$.infoInit = function() {
			$.ajax({
				type: "get",
				url: "product.json",
				async: false,
				dataType: "json",
				success: function(res) {
					bannerImg = res.banner_img;
					bannerImg2 = res.banner_img2;
					curTime = res.curTime;
					startTime = res.start_time;
					endTime = res.end_time;
					productImg = res.product_img;
					productName = res.product_name;
					listJoin = res.list_join;
					isGuanzhu = res.is_guanzhu;
					jianTeam = res.jian_team;
					jiaTeam = res.jia_team;
					//设置banner
					$(".banner .img").attr("src", bannerImg);

					//设置产品
					$(".product img").attr("src", productImg);
					$(".product h3").html(productName);

					//初始头像名字为空
					$(".list-join s").hide();
					//设置倒计时
					var seconds, cur;
					var timer = null;
					cur = Math.floor(new Date().getTime() / 1000);
					start = Math.floor(new Date(startTime).getTime() / 1000);
					end = Math.floor(new Date(endTime).getTime() / 1000);

					if(cur < start) {
						clearInterval(timer)
						status = 0;
						console.log("活动还未开始!");
						openLayer("[data-name=活动未开始]")
					}

					if(cur <= end && cur >= start) {
						status = 1;
						console.log("活动进行中!")

						seconds = end - cur;
						daojishi(seconds);

						//请求接口定时获取拼团信息msg开始
						var timerMsg = null;
						$.msg()
						timerMsg = setInterval(function() {
							$.msg();
						}, 5000);

						//设置邀请人
						$(".list-join s").show();
						var joinStr = '';
						for(var i = 0; i < listJoin.length; i++) {
							switch(i) {
								case 0:
									$(".list-join span").eq(i).find('b').addClass('tx').html('<img src="' + listJoin[i].thumbs + '"/>');
									$(".list-join span").eq(i).find('.name2').html(listJoin[i].name)
									break;
								default:
									$(".list-join span").eq(i).find('b').addClass('tx').html('<img src="' + listJoin[i].thumbs + '"/>');
									$(".list-join span").eq(i).find('.name2').html(listJoin[i].name)
									break;
							}
						}
						if(listJoin.length == 0) {
							$(".list-join s").hide();
						}
						if(listJoin.length == 1 || listJoin.length == 2) {
							$("[data-name=创建我的团]").hide();
							$("[data-name=创建新团]").hide();
							$("[data-name=邀请好友入团]").show();
						}
						if(listJoin.length == 3) {
							$(".list-join u").show();
							$("[data-name=创建我的团]").hide();
							$("[data-name=创建新团]").show();
						}
						if(teamID) {
							if(listJoin.length == 0) {
								alertTest("错误分享地址！")
								return false;
							} else {
								if(listJoin.length == 3) {
									$("[data-name=创建我的团]").show();
									$("[data-name=创建新团]").hide();
									$("[data-name=加入团]").hide();
									$("[data-name=邀请好友入团]").hide();
								} else {
									$("[data-name=创建我的团]").hide();
									$("[data-name=创建新团]").hide();
									$("[data-name=加入团]").show();
									$("[data-name=邀请好友入团]").hide();
								}
							}
						} else {

						}
					}

					if(cur > end) {
						clearInterval(timer)
						status = 2;
						console.log("活动已经结束!");
						openLayer('[data-name=活动已结束]');

						//设置邀请人
						$(".list-join s").show();
						var joinStr = '';
						for(var i = 0; i < listJoin.length; i++) {
							switch(i) {
								case 0:
									$(".list-join span").eq(i).find('b').addClass('tx').html('<img src="' + listJoin[i].thumbs + '"/>');
									$(".list-join span").eq(i).find('i').html(listJoin[i].name)
									break;
								default:
									$(".list-join span").eq(i).find('b').addClass('tx').html('<img src="' + listJoin[i].thumbs + '"/>');
									$(".list-join span").eq(i).find('i').html(listJoin[i].name)
									break;
							}
						}
						if(listJoin.length == 0) {
							$(".list-join s").hide();
						}
						if(listJoin.length == 3) {
							$(".list-join u").show();
						}
					}

					console.log("status:" + status);

				}
			});
		}

		function pinTuan(obj) {
			//拼团邀请是否关注
			var status = $(obj).find('b').hasClass("tx");
			if(!status) {
				if(isGuanzhu) {
					//建团成功
					openLayer('[data-name=分享]')
				} else {
					//弹层关注
					openLayer('[data-name=二维码弹层]')
				}
			}
		}

		function createTeam(obj) {
			if(status == 0) {
				openLayer('[data-name=活动未开始]');
				return false;
			}
			if(status == 2) {
				openLayer('[data-name=活动已结束]');
				return false;
			}
			if(status == 1) {
				if(isGuanzhu) {
					if(jianTeam >= 0 && jianTeam < 5) {
						//建团成功并显示
						$.ajax({
							type: "get",
							url: "creatTeam.json",
							async: false,
							dataType: "json",
							success: function(res) {
								var teamId = res.team_id;
								var teamQRcode = res.team_qrcode;
								var listJoin1 = res.list_join;

								$("[data-name=创建我的团]").hide();
								$("[data-name=邀请好友入团]").show();
								$("[data-name=创建新团]").hide();

								$(".btn-group .qr-code img").attr("src", teamQRcode);

								//设置邀请人
								$(".list-join s").show();

								$(".list-join span").eq(0).find('b').addClass('tx').html('<img src="' + listJoin1[0].thumbs + '"/>');
								$(".list-join span").eq(0).find('.name2').html(listJoin1[0].name)
								$(".list-join span").eq(1).html('<b class="plus"></b><s><i class="name2">--</i></s>')
								$(".list-join span").eq(2).html('<b class="plus"></b><s><i class="name2">--</i></s>')

								if(listJoin1.length == 0) {
									$(".list-join s").hide();
								}
								if(listJoin1.length == 3) {
									$(".list-join u").show();
								}

								//隐藏成功
								$(".list-join u").hide();
							}
						});
					} else {
						openLayer('[data-name=不允许建团]');
					}
				} else {
					//弹层关注
					openLayer('[data-name=二维码弹层]')
				}
			}
		};

		function showQRcode() {
			var isShow = $(".btn-group .qr-code").css("display");
			if(isShow == "none") {
				$(".btn-group .qr-code").show();
			} else {
				$(".btn-group .qr-code").hide();
			}
		}

		$.msg = function() {
			if(count != 1) {
				$(".list-msg").remove();
			}
			var msgItem = '';
			$.ajax({
				type: "get",
				url: "msg.json",
				async: false,
				dataType: "json",
				success: function(res) {
					visited = res.visited;
					var myMsg = res.msg; //信息内容(img/name/type)
					for(var i = 0; i < myMsg.length; i++) {
						msgItem += '<li><span class="msg-item"><img src="' + myMsg[i].img + '"/>' + myMsg[i].name + count + '&nbsp;&nbsp;' + myMsg[i].type + '</span></li>';
					};
					msgItem = '<ul class="list-msg animated fadeInDownThenhide">' + msgItem + '</ul>';
					count++;
					$(".banner").append(msgItem);

					$(".enter b").html(visited);
				}
			});
		}

		function joinTeam() {
			if(jiaTeam >= 0 && jiaTeam < 5) {
				console.log('我已经加入了团!ajax请求')
			} else {
				openLayer('[data-name=不允许加团]');
			}
		}
		$(function() {
			var loadTime = null;
			loadTime = setTimeout(function() {
				$('.loader').addClass('fadeOut animated2').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {
					$(this).hide();
				});
			}, 3000)
		})
	</script>

</html>